# Migration from 0.10.x to 0.11.x

## Deprecations

### Folder Structure
Most files and all of the source has been moved into the `src/` folder, which no longer resides in the `z_framework` folder, but in the vendor directory, managed by composer.

### Application Entry
A `main.php` file does no longer exist. The entry file has changed and needs to include the following now.:
``` PHP
require_once "vendor/autoload.php";

// ZubZet Initialization
$app = new ZubZet\Core(root: __DIR__);
$app->execute();
```

### Class Name Changes
The class `z_framework` is now called `Core`. If you use typed parameters referencing this class, they have to be removed or updated.

### Password Hash Utilities
The `z_libs` directory has been deprecated. All libraries and modules will be included using composer from now on. This does not affect the user space. The password hash library is now packaged as `zubzet/password-hash-utilities`.

#### Namespace (required)
The following namespace has to be included:
``` PHP
use ZubZet\Utilities\PasswordHash\PasswordHash;
```

#### Function calls (required)
- Replace `checkPassword` with `check`
- Replace `createPassword` with `create`

#### New required parameter (required)
The parameter `hashingName` has to be set. When migrating from the older version, a legacy algorithm has been implemented as `sha512`.

#### New database field (required)
Two new database fields are needed to support the versioning of passwords. You can create them using the following command:

``` SQL
ALTER TABLE `z_user`
    ADD `hash_name` VARCHAR(255) NOT NULL DEFAULT 'sha512' AFTER `salt`,
    ADD `custom_logic_name` VARCHAR(255) NULL DEFAULT '0.9' AFTER `hash_name`;
```

#### Check a password
``` PHP
$check = PasswordHash::check(
    "password123",
    FROM_DB_HASH,
    FROM_DB_SALT,
    FROM_DB_HASH_NAME,
    customLogicName: FROM_DB_CUSTOM_LOGIC,
);
```

When no new fields are wanted or you are not able to add them:
- `FROM_DB_HASH_NAME` can also be implemented as `FROM_DB_HASH_NAME ?? "sha512"`
- `FROM_DB_CUSTOM_LOGIC` can also be implemented as `FROM_DB_HASH_NAME ?? "0.9"`

#### ResultObject
The check function will no longer return a single boolean. Check for verification by reading `result->matches`.

In case of a newer custom logic or hash name (`result->hasUpdate` is `true`), update the old password hash in the database.

// TODO: Implement z_user->updatePassword

Structure of result object:
- `matches` True when user input is correct.
- `hasUpdate` True when a new hashingName or customLogic are used.
- `hash` Generated hash with the target algorithm (Overwrite this in DB if hasUpdate is true)
- `salt` Newly generated salt (Overwrite this in DB if hasUpdate is true)
- `hashingName` is the name of the used hashing algorithm. (Overwrite this in DB if hasUpdate is true)
- `customLogicName` is the name of the used custom logic. (Overwrite this in DB if hasUpdate is true)

#### Create a new password

``` PHP
$password = PasswordHash::create("password123");

// Save the following values to the database:
$password->hash;
$password->salt;
$password->hashingName;
$password->customLogicName; // Optional
```